{"ast":null,"code":"import _regeneratorRuntime from\"/Users/kriseldabonifacio/course_work/Strangers_things/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/kriseldabonifacio/course_work/Strangers_things/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/kriseldabonifacio/course_work/Strangers_things/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{useNavigate}from\"react-router\";import\"./Account.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var AccountForm=function AccountForm(_ref){var setToken=_ref.setToken,action=_ref.action,setIsLoggedIn=_ref.setIsLoggedIn,isLoggedIn=_ref.isLoggedIn,setCurrentUser=_ref.setCurrentUser;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),username=_useState2[0],setUsername=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPassword=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),showCredentialsError=_useState6[0],setShowCredentialsError=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),accountError=_useState8[0],setAccountError=_useState8[1];var navigate=useNavigate();useEffect(function(){if(isLoggedIn)navigate('/account');},[]);var fetchUserData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(auth_user_token){var response,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return fetch('https://strangers-things.herokuapp.com/api/2108-CSE-RM-WEB-PT/users/me',{headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(auth_user_token)}});case 3:response=_context.sent;_context.next=6;return response.json();case 6:result=_context.sent;return _context.abrupt(\"return\",result);case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return function fetchUserData(_x){return _ref2.apply(this,arguments);};}();var submitAccountInfo=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var response,result,auth_user_token,userData,errorMessage;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;event.preventDefault();_context2.next=4;return fetch(\"https://strangers-things.herokuapp.com/api/2108-CSE-RM-WEB-PT/users/\".concat(action),{method:\"POST\",headers:{'Content-Type':'application/json'},body:JSON.stringify({user:{username:username,password:password}})});case 4:response=_context2.sent;_context2.next=7;return response.json();case 7:result=_context2.sent;auth_user_token=result.data.token;setToken(auth_user_token);setIsLoggedIn(true);_context2.next=13;return fetchUserData(auth_user_token);case 13:userData=_context2.sent;setCurrentUser(userData.data.username);setShowCredentialsError(false);navigate('/account');_context2.next=25;break;case 19:_context2.prev=19;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);errorMessage=action==='login'?\"Incorrect username and password combination.\":\"Username already taken.\";setAccountError(errorMessage);setShowCredentialsError(true);case 25:case\"end\":return _context2.stop();}}},_callee2,null,[[0,19]]);}));return function submitAccountInfo(_x2){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"actionHeader\",children:action}),/*#__PURE__*/_jsx(\"div\",{className:\"formContainer\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:submitAccountInfo,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:username,placeholder:\"username\",onChange:function onChange(event){setUsername(event.target.value);}}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:password,placeholder:\"password\",onChange:function onChange(event){setPassword(event.target.value);}}),/*#__PURE__*/_jsx(\"div\",{className:\"buttonContainer\",children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Submit\"})})]})}),showCredentialsError?/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:accountError}):null]});};export default AccountForm;","map":{"version":3,"sources":["/Users/kriseldabonifacio/course_work/Strangers_things/src/components/Account.js"],"names":["React","useState","useEffect","useNavigate","AccountForm","setToken","action","setIsLoggedIn","isLoggedIn","setCurrentUser","username","setUsername","password","setPassword","showCredentialsError","setShowCredentialsError","accountError","setAccountError","navigate","fetchUserData","auth_user_token","fetch","headers","response","json","result","submitAccountInfo","event","preventDefault","method","body","JSON","stringify","user","data","token","userData","console","log","errorMessage","target","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router\";\nimport \"./Account.css\" \n\n\nconst AccountForm = ({setToken, action, setIsLoggedIn, isLoggedIn, setCurrentUser}) => {\n  const [username, setUsername] = useState('')\n  const [password, setPassword] = useState('')\n  const [showCredentialsError, setShowCredentialsError] = useState(false)\n  const [accountError, setAccountError] = useState('')\n  const navigate = useNavigate()\n\n\n  useEffect(() => {\n    if (isLoggedIn) navigate('/account')\n  }, [])\n\n  const fetchUserData = async (auth_user_token) => {\n      try {\n          const response = await fetch ('https://strangers-things.herokuapp.com/api/2108-CSE-RM-WEB-PT/users/me', {\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${auth_user_token}`\n            }\n        })\n          const result = await response.json()\n          return result\n      } catch (error) {\n          \n      }\n  }\n\n  const submitAccountInfo = async (event) => {\n    try {\n      event.preventDefault();\n      const response = await fetch(`https://strangers-things.herokuapp.com/api/2108-CSE-RM-WEB-PT/users/${action}`, {\n        method: \"POST\",\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          user: {\n            username: username,\n            password: password\n          }\n        })\n      })\n      const result = await response.json()\n      const auth_user_token = result.data.token\n      setToken(auth_user_token)\n      setIsLoggedIn(true)\n  \n\n      const userData = await fetchUserData(auth_user_token)\n      setCurrentUser(userData.data.username)\n      setShowCredentialsError(false)\n      navigate('/account')\n    } catch (error) {\n      console.log(error)\n      const errorMessage = action === 'login' ? \"Incorrect username and password combination.\" : \"Username already taken.\"\n      setAccountError(errorMessage)\n      setShowCredentialsError(true)\n    }\n  }\n\n  return <>\n    <div className=\"actionHeader\">{action}</div>\n    <div className='formContainer'><form onSubmit={submitAccountInfo}>\n      <input type=\"text\" value={username} placeholder=\"username\" onChange={(event)=>{setUsername(event.target.value)}}/>\n      <input type=\"password\" value={password} placeholder=\"password\" onChange={(event)=>{setPassword(event.target.value)}}/>\n      <div className='buttonContainer'><button type=\"submit\">Submit</button></div>\n    </form></div>\n    { showCredentialsError ? <div className=\"error\">{accountError}</div> : null }\n   \n  </>\n}\n\nexport default AccountForm;\n"]},"metadata":{},"sourceType":"module"}