{"ast":null,"code":"import _regeneratorRuntime from\"/Users/kriseldabonifacio/course_work/Strangers_things/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/kriseldabonifacio/course_work/Strangers_things/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/kriseldabonifacio/course_work/Strangers_things/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{useNavigate}from\"react-router\";import\"./Account.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var AccountForm=function AccountForm(_ref){var setToken=_ref.setToken,action=_ref.action,setIsLoggedIn=_ref.setIsLoggedIn,isLoggedIn=_ref.isLoggedIn,setCurrentUser=_ref.setCurrentUser;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),username=_useState2[0],setUsername=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),password=_useState4[0],setPassword=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),showCredentialsError=_useState6[0],setShowCredentialsError=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),accountError=_useState8[0],setAccountError=_useState8[1];var navigate=useNavigate();useEffect(function(){if(isLoggedIn)navigate('/account');},[]);var fetchUserData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(auth_user_token){var response,result;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return fetch('https://strangers-things.herokuapp.com/api/2108-CSE-RM-WEB-PT/users/me',{headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(auth_user_token)}});case 3:response=_context.sent;_context.next=6;return response.json();case 6:result=_context.sent;console.log('fetchuserdata',result);return _context.abrupt(\"return\",result);case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,11]]);}));return function fetchUserData(_x){return _ref2.apply(this,arguments);};}();var submitAccountInfo=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var response,result,auth_user_token,userData,errorMessage;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;event.preventDefault();_context2.next=4;return fetch(\"https://strangers-things.herokuapp.com/api/2108-CSE-RM-WEB-PT/users/\".concat(action),{method:\"POST\",headers:{'Content-Type':'application/json'},body:JSON.stringify({user:{username:username,password:password}})});case 4:response=_context2.sent;_context2.next=7;return response.json();case 7:result=_context2.sent;auth_user_token=result.data.token;console.log('promise',result);setToken(auth_user_token);setIsLoggedIn(true);_context2.next=14;return fetchUserData(auth_user_token);case 14:userData=_context2.sent;console.log('userData',userData);setCurrentUser(userData.data.username);setShowCredentialsError(false);navigate('/account');_context2.next=27;break;case 21:_context2.prev=21;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);errorMessage=action==='login'?\"Incorrect username and password combination.\":\"Username already taken.\";setAccountError(errorMessage);setShowCredentialsError(true);case 27:case\"end\":return _context2.stop();}}},_callee2,null,[[0,21]]);}));return function submitAccountInfo(_x2){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"actionHeader\",children:action}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:submitAccountInfo,children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:username,placeholder:\"username\",onChange:function onChange(event){setUsername(event.target.value);}})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:password,placeholder:\"password\",onChange:function onChange(event){setPassword(event.target.value);}})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"submit\"})})]}),showCredentialsError?/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:accountError}):null]});};export default AccountForm;","map":{"version":3,"sources":["/Users/kriseldabonifacio/course_work/Strangers_things/src/components/Account.js"],"names":["React","useState","useEffect","useNavigate","AccountForm","setToken","action","setIsLoggedIn","isLoggedIn","setCurrentUser","username","setUsername","password","setPassword","showCredentialsError","setShowCredentialsError","accountError","setAccountError","navigate","fetchUserData","auth_user_token","fetch","headers","response","json","result","console","log","submitAccountInfo","event","preventDefault","method","body","JSON","stringify","user","data","token","userData","errorMessage","target","value"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useNavigate } from \"react-router\";\nimport \"./Account.css\" \n\n\nconst AccountForm = ({setToken, action, setIsLoggedIn, isLoggedIn, setCurrentUser}) => {\n  const [username, setUsername] = useState('')\n  const [password, setPassword] = useState('')\n  const [showCredentialsError, setShowCredentialsError] = useState(false)\n  const [accountError, setAccountError] = useState('')\n  const navigate = useNavigate()\n\n\n  useEffect(() => {\n    if (isLoggedIn) navigate('/account')\n  }, [])\n\n  const fetchUserData = async (auth_user_token) => {\n      try {\n          const response = await fetch ('https://strangers-things.herokuapp.com/api/2108-CSE-RM-WEB-PT/users/me', {\n            headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${auth_user_token}`\n            }\n        })\n          const result = await response.json()\n          console.log('fetchuserdata', result)\n          return result\n      } catch (error) {\n          \n      }\n  }\n\n  const submitAccountInfo = async (event) => {\n    try {\n      event.preventDefault();\n      const response = await fetch(`https://strangers-things.herokuapp.com/api/2108-CSE-RM-WEB-PT/users/${action}`, {\n        method: \"POST\",\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          user: {\n            username: username,\n            password: password\n          }\n        })\n      })\n      const result = await response.json()\n      const auth_user_token = result.data.token\n      console.log('promise', result)\n      setToken(auth_user_token)\n      setIsLoggedIn(true)\n  \n\n      const userData = await fetchUserData(auth_user_token)\n      console.log('userData', userData)\n      setCurrentUser(userData.data.username)\n      setShowCredentialsError(false)\n      navigate('/account')\n    } catch (error) {\n      console.log(error)\n      const errorMessage = action === 'login' ? \"Incorrect username and password combination.\" : \"Username already taken.\"\n      setAccountError(errorMessage)\n      setShowCredentialsError(true)\n    }\n  }\n\n  return <>\n    <div className=\"actionHeader\">{action}</div>\n    <form onSubmit={submitAccountInfo}>\n      <div><input type=\"text\" value={username} placeholder=\"username\" onChange={(event)=>{setUsername(event.target.value)}}/></div>\n      <div><input type=\"password\" value={password} placeholder=\"password\" onChange={(event)=>{setPassword(event.target.value)}}/></div>\n      <div><button type=\"submit\">submit</button></div>\n    </form>\n    { showCredentialsError ? <div className=\"error\">{accountError}</div> : null }\n\n  </>\n}\n\nexport default AccountForm;\n"]},"metadata":{},"sourceType":"module"}